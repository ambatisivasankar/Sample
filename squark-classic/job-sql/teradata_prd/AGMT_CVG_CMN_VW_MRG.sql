


DELETE FROM DMD_TEST.AGMT_CVG_CMN_VW WHERE (agreement_id,COVERAGE_KEY) in ( select hist_agreement_id,hist_COVERAGE_KEY from SQUARK_STAGING.AGMT_CVG_CMN_VW WHERE agreement_id IS NULL );

DELETE FROM DMD_TEST.AGMT_CVG_CMN_VW WHERE (agreement_id,COVERAGE_KEY) in ( select agreement_id,COVERAGE_KEY from SQUARK_STAGING.AGMT_CVG_CMN_VW WHERE agreement_id IS NOT NULL );

INSERT INTO DMD_TEST.AGMT_CVG_CMN_VW
SELECT DISTINCT
AGREEMENT_ID,
 AGREEMENT_SOURCE_CD,
 HLDG_KEY_PFX,
 HLDG_KEY,
 HLDG_KEY_SFX,
 COVERAGE_KEY,
 COVERAGE_FR_DT,
 CVG_RIDER_TYP_CD,
 AGMT_CVG_CTGY,
 SRC_CVG_CTGRY_CD,
 AGMT_CVG_SEQ_NR,
 COVERAGE_TO_DT,
 CVG_EFF_DT,
 SRC_CVG_EFF_TXT,
 CVG_TERM_DATE,
 CVG_PROD_ID,
 CVG_PROD_TYP,
 CVG_KIND_PLAN_CD,
 CVG_ISSUE_BASIS,
 CVG_PRODUCT_VERSION_CODE,
 CVG_MINOR_PROD_CDE,
 CVG_STATUS_CD,
 SRC_CVG_XCPT_STUS_CD,
 CVG_STATUS_RSN_DESC,
 CVG_ACTIVE_IND,
 CVG_OCCUPATIONAL_RATING_CLASS,
 SRC_OCC_CLS_CD,
 CVG_ISSUE_AGE,
 CVG_SMOKER_STAT,
 SRC_SMKR_CD,
 CVG_TABLE_RATING,
 CVG_INSD_PERM_TEMP_CODE,
 CVG_RET_OF_PREM_POL_NR,
 CVG_SHORT_NAME,
 CVG_MARKETING_NAME,
 CVG_INDIC_ATOR_CODE,
 CVG_PRSN_CDE,
 YOUNGEST_CVG_PRSN_AGE,
 ELIG_FOR_WITHDRAWL_AGE,
 BEN_XRCIS_IND,
 AGMT_CVG_BEN_DATA_FR_DT,
 AGMT_CVG_BEN_DATA_TO_DT,
 CVG_FACE_AMT,
 CVG_INCOME_AMT,
 CVG_INCREASE_PERCENT,
 CVG_FLAT_EXTRA_AMOUNT,
 CVG__FLAT_EXTRA_END_DATE,
 CVG_ELIM_PERIOD_SICK,
 CVG_ELIM_PERIOD_SICK_CODE,
 CVG_DISABILITY_WAIT_PEROD,
 CVG_DISABILITY_WAIT_PEROD_CD,
 CVG_BENEFIT_PERIOD_SICK,
 CVG_BENEFIT_PERIOD_SICK_CODE,
 CVG_BENEFIT_PERIOD_INJURY,
 CVG_BENEFIT_PERIOD_INJURY_CD,
 CVG_CROSSOVER_OPT_DATE,
 CVG_DIV_CASH_VAL,
 CVG_1035_IND,
 CONVERSION_START_DATE,
 CONVERSION_END_DATE,
 CVG_EXERCISE_DATE_FIO,
 BENE_TYP_AMT,
 BENE_TYP_PCT_AMT,
 BENE_PRD_YR_CNT,
 BENE_BAS_VAL_FXD_DT,
 AVAIL_WDRWL_AMT,
 AGMT_CVG_BILL_DATA_FR_DT,
 CVG_PAYMENT_TIME_PERIOD,
 SRC_BILL_MODE_CD,
 AGMT_CVG_BILL_DATA_TO_DT,
 CVG_PAYMENT_OPTION_CD,
 SRC_BILL_MTHD_TYP_CD,
 CVG_EBILL_PREF,
 COVG_PREMIUM_AMT,
 COVG_WP_PREMIUM_AMT,
 CVG_IAR_COLA_PREM_AMT,
 CVG_TOT_ANNUAL_PREM_AMT,
 CVG_FLAT_EXTRA_PREMIUM_AMT,
 INVOICE_TYPE_CD,
 CVG_TOT_ANNUAL_PREM_AMOUNT,
 CVG_PERM_FLAT_EXTRA_END_DATE,
 CVG_SCHED_UNSCHED_CD,
 CVG_UNSCHED_PREM_AMT_ATD,
 CVG_RECMMD_PREM_AMT,
 CVG_PYMNT_ADDNS_AMT,
 CVG_DIVD_ADDNS_AMT,
 CVG_BASE_PAYMENT_AMT,
 CVG_WP_PAYMENT_AMT,
 CVG_MODAL_GROSS_TOT_PREM_AMT,
 CVG_MAX_ANNL_PYMT_AMT,
 CVG_PEND_COLLECT_IND,
 CVG_PAID_TO_DATE,
 CVG_LAST_PAYMENT_DATE,
 CVG_BILL_TO_DT,
 LOB_CDE,
 LOB_NME,
 MAJOR_PROD_CDE,
 MAJOR_PROD_NME,
 MINOR_PROD_CDE,
 PROD_TYP_CDE,
 PROD_TYP_NME,
 QUAL_CDE,
 ADMN_SYS_CDE,
 MINOR_PROD_NME,
 OPN_CLOS_BLCK_DESC,
 SRC_CVG_EFF_DATE,
 SRC_CVG_TERM_DATE,
 CVG_NXT_FIO_DT,
 CVG_SSTD_RATING_TYPE_1,
 SRC_SSTD_RTNG_TYP_1_CD,
 CVG_SSTD_RATING_PCT_1,
 CVG_SSTD_RATING_TYPE_2,
 SRC_SSTD_RTNG_TYP_2_CD,
 CVG_SSTD_RATING_PCT_2,
 CVG_FIO_EXP_DT,
 CVG_TERM_DIVD_COST,
 CVG_FLEX_TARGET_AMT,
 CVG_REM_BASE_FIO_AMT,
 CVG_SRC_DISCOUNT_TYP,
 CVG_DISCOUNT_AMT,
 CVG_DEVIATION_PCT,
 CVG_DISCOUNT_REASON_DESC,
 CVG_INCR_CNTR,
 ELIM_PERIOD_SICK,
 DISABILITY_WAIT_PERIOD,
 BENEFIT_PERIOD_SICK,
 BENEFIT_PERIOD_INJURY,
 PROD_ENTRPRISE_NM,
 PROD_DISPLY_ORDER,
 DISPLAY_BENEFIT_PERIOD,
 DISPLAY_WAIT_PERIOD,
 DSPLY_BEN_COLUM,
 CVG_DIV_TYPE,
 SRC_CVG_DIV_OPT_CD,
 CVG_SECOND_DIV_TYPE,
 SRC_SCND_DIVD_OPT_CD,
 CVG_TBL_RTNG_PCT,
 AGMT_FR_DT,
 COVERED_INSD_CD,
 OCC_CLS_MOD,
 CVG_PERIOD,
 SRC_CVG_PERIOD,
 CVG_ELIM_PERIOD_SICK_DESC,
 CVG_DISABILITY_WAIT_PEROD_DESC,
 CVG_BENEFIT_PERIOD_SICK_DESC,
 CVG_BENEFIT_PERIOD_INJURY_DESC,
 CVG_CSH_VAL_AMT,
 CVG_CSH_VAL_QLTY_CD,
 _advana_md5,
 _advana_id,
 _advana_load_date
  FROM SQUARK_STAGING.AGMT_CVG_CMN_VW 
  WHERE
   AGREEMENT_ID IS NOT NULL AND COVERAGE_KEY IS NOT NULL;
 
COMMIT;