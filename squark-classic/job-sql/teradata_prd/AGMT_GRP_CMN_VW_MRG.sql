

DELETE FROM DMD_TEST.AGMT_GRP_CMN_VW WHERE (GROUPING_KEY, GROUP_DATA_SRC,  CAST(GROUPING_KEY_FR_DT AS DATE)) in ( select HIST_GROUPING_KEY,  HIST_GROUP_DATA_SRC, CAST(HIST_GRP_KEY_FR_DT AS DATE) from SQUARK_STAGING.AGMT_GRP_CMN_VW WHERE CAST(HIST_GRP_KEY_TO_DT AS DATE)<>'9999-12-31' );

DELETE FROM DMD_TEST.AGMT_GRP_CMN_VW WHERE (GROUPING_KEY, GROUP_DATA_SRC,  CAST(GROUPING_KEY_FR_DT AS DATE)) in ( select GROUPING_KEY, GROUP_DATA_SRC, CAST(GROUPING_KEY_FR_DT AS DATE) from SQUARK_STAGING.AGMT_GRP_CMN_VW where GROUPING_KEY is not null);

INSERT INTO DMD_TEST.AGMT_GRP_CMN_VW
SELECT  GROUPING_KEY,
 GROUPING_KEY_FR_DT,
 GROUP_DATA_SRC,
 GROUP_NM_FRMT,
 GROUP_NM,
 GROUP_BILL_NM_FRMT,
 GROUP_BILL_NM,
 GROUP_DISTRIBUTOR_ID,
 GROUP_PRODUCER_ID,
 GROUP_BILL_MODE,
 GROUP_BILL_MODE_DESC,
 GROUP_TAX_ID,
 GROUP_DUE_DT,
 GROUP_QUAL_PLAN_IND,
 GROUP_OWND_IND,
 GROUP_SAL_DED_IND,
 GROUP_TSA_IND,
 GROUP_APPL_DIV_IND,
 GROUP_RETURN_ADDR_CD,
 GROUP_AS_OF_DT,
 GROUP_BILL_TYP,
 GROUP_COMPANY_CD,
 GROUP_FRAN_TYP,
 GROUP_FRAN_START_ID,
 GROUP_STAT_CD,
 GROUP_SRC_SYS_ID,
 PRODUCT_GROUPING,
 MM_CAMPUS_CODE,
 SRC_MM_CAMPUS_CODE,
 BLEND_GENDER_IND,
 BLEND_SMOKER_IND,
 CASE_MANGER_FULL_NM,
 CLIENT_NO,
 MARKET_TYPE_CODE,
 SRC_MARKET_TYPE_CODE,
 CONTRACT_FULL_NAME,
 DISTRIBUTION_CHANNEL_CODE,
 SRC_DTRB_CHNL_CD,
 GROUP_CONTRACT_EFF_DT,
 EXPERIENCE_RATE_DT,
 EXPERIENCE_RATE_IND,
 ORGANIZATION_TYPE_CODE,
 SRC_ORGANIZATION_TYPE_CODE,
 INFORCE_EXPERIENCE_RATE_FACTOR,
 ISSUE_STATE_CD,
 SRC_ISSUE_COMPANY_CD,
 MALE_PROPORTION_PCT,
 MM_FUND_SET_NO,
 NON_SMKR_PROPORTION_PCT,
 PENDING_SURRENDER_IND,
 REPLACEMENT_IND,
 SRC_REPL_IND,
 SALES_MANAGER_FULL_NM,
 TAX_1035_XCH_CHRG_IND,
 CURRENT_LOAN_RATE,
 REPORT_PROFIT_CENTR_NM,
 GOVT_ID_TYPE_CODE,
 SRC_GOVT_ID_TYPE_CODE,
 ADDRESS_LN1,
 ADDRESS_LN2,
 ADDRESS_LN3,
 CITY_NM,
 STATE_CD,
 ZIP_CD,
 ZIP_CD_EXTENSION,
 DOMESTIC_FOREIGN_CODE,
 SRC_DOMESTIC_FOREIGN_CODE,
 PROVINCE_NM,
 COUNTRY_NM,
 FORGEIN_POSTAL_CD,
 GRP_IPN,
 GRP_EFF_DT, 
 _advana_md5,
 _advana_id,
 _advana_load_date FROM SQUARK_STAGING.AGMT_GRP_CMN_VW WHERE GROUPING_KEY IS NOT NULL
;
COMMIT;
